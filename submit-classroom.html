<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Classroom / Facility Maintenance Request</title>
<style>
:root{--ink:#e5e7eb;--muted:#94a3b8;--card:#0b1324;--line:#1f2937;--bg:#0b1220;--accent:#22c55e}
*{box-sizing:border-box}body{margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--ink)}
.wrap{max-width:860px;margin:40px auto;padding:20px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:22px;box-shadow:0 6px 30px rgba(0,0,0,.25)}
h1{margin:0 0 6px}.muted{color:var(--muted);margin:0 0 16px}
label{display:block;margin:12px 0 6px}
input,textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #374151;background:#0b1324;color:var(--ink)}
textarea{min-height:120px;resize:vertical}
.grid{display:grid;gap:14px;grid-template-columns:1fr 1fr}
.actions{display:flex;gap:10px;margin-top:16px;align-items:center;flex-wrap:wrap}
button{border:0;border-radius:10px;padding:12px 16px;font-weight:600;cursor:pointer;background:var(--accent);color:#021}
button.secondary{background:#334155;color:#e5e7eb}
.toast{margin-top:12px;padding:10px;border-radius:10px;background:#052e1a;color:#d1fae5;display:none}
.err{margin-top:12px;padding:10px;border-radius:10px;background:#3b1d1d;color:#fecaca;display:none}
a{color:#93c5fd}
</style>
</head>
<body>
    <div class="wrap">
     <center> <h1>PLT COLLEGE, INC.</h1>
      <h6>An Incon in Humane Education</h6></center
    </div>
<div class="wrap">
  <div class="card">
    <h1>Classroom / Facility Maintenance</h1>
    <p class="muted">Please provide the details below. Upon submission, your request will be recorded and queued for action.</p>
    <form id="f" autocomplete="off">
      <div class="grid">
        <div>
          <label for="dept">Department *</label>
          <input id="dept" required list="deptList" placeholder="e.g., Facilities, Registrar, IT"/>
          <datalist id="deptList"><option>Facilities</option><option>Registrar</option><option>IT</option><option>Finance</option><option>Library</option><option>HR</option></datalist>
        </div>
        <div>
          <label for="req">Name of Requester *</label>
          <input id="req" required placeholder="Your name"/>
        </div>
      </div>

      <label for="part">Particulars *</label>
      <input id="part" required placeholder="e.g., Electrical, Lighting, Plumbing, Air-conditioning, Furniture"/>

      <div class="grid">
        <div>
          <label for="loc">Exact Location *</label>
          <input id="loc" required placeholder="e.g., Building A, Room 203 (front left wall)"/>
        </div>
        <div>
          <label for="dateFiled">Date Filed</label>
          <input id="dateFiled" disabled/>
        </div>
      </div>

      <label for="desc">Description of Repair *</label>
      <textarea id="desc" required placeholder="Describe the issue and any relevant details."></textarea>

      <div class="actions">
        <button type="submit">Submit Request</button>
        <button type="reset" class="secondary">Clear</button>
        <a href="/index.html">Back to Landing</a>
      </div>
      <div id="toast" class="toast">Submitted. Reference: <b id="ref"></b></div>
      <div id="err" class="err"></div>
    </form>
  </div>
</div>

<script>
function fmtNow(){ const d=new Date(); return d.toLocaleString(); }
function shortRef(prefix='CR'){ const d=new Date(); const y=String(d.getFullYear()).slice(-2); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); const h=String(d.getHours()).padStart(2,'0'); const min=String(d.getMinutes()).padStart(2,'0'); return `${prefix}-${y}${m}${day}${h}${min}-`+Math.random().toString(36).slice(2,6).toUpperCase(); }
document.getElementById('dateFiled').value = fmtNow();

async function readError(r){ const ct=r.headers.get('content-type')||''; if(ct.includes('application/json')){ try{ const j=await r.json(); return j.error||JSON.stringify(j);}catch{}} try{return (await r.text()).slice(0,400);}catch{return r.statusText;} }

document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    reference: shortRef(),
    department: document.getElementById('dept').value.trim(),
    requester:  document.getElementById('req').value.trim(),
    particulars: document.getElementById('part').value.trim(),
    location:   document.getElementById('loc').value.trim(),
    description:document.getElementById('desc').value.trim(),
    dateFiled:  new Date().toISOString(),
    createdAt:  new Date().toISOString(),
    status: 'Open',
    completedAt: null
  };
  const err = document.getElementById('err'); err.style.display='none';
  try{
    const r = await fetch('/api/classroomtickets', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    if(!r.ok) throw new Error(await readError(r));
    document.getElementById('ref').textContent = payload.reference;
    document.getElementById('toast').style.display='block';
    e.target.reset(); document.getElementById('dept').focus(); document.getElementById('dateFiled').value = fmtNow();
  }catch(ex){ err.textContent = 'Submit failed: '+ex.message; err.style.display='block'; }
});
</script>
</body>
</html>
