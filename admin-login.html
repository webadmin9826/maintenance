<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Registrar Admin Login</title>
<style>
  :root{--ink:#e5e7eb;--muted:#94a3b8;--card:#0b1324;--line:#1f2937;--bg:#0b1220;--accent:#22c55e;--danger:#ef4444}
  *{box-sizing:border-box}body{margin:0;font:15px/1.48 system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1100px;margin:36px auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:22px;box-shadow:0 6px 30px rgba(0,0,0,.25)}
  h1{margin:0 0 10px}.muted{color:var(--muted)}
  label{display:block;margin:10px 0 6px}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1324;color:var(--ink)}
  textarea{min-height:120px;resize:vertical}
  .row{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
  button{border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .primary{background:var(--accent);color:#031}
  .ghost{background:#1f2937;color:#e5e7eb}
  .danger{background:var(--danger);color:#ffe4e6}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{padding:10px 12px;text-align:left;vertical-align:top}
  thead th{color:#cbd5e1}
  tbody tr{background:var(--card);border:1px solid var(--line)}
  .chip{display:inline-block;padding:4px 8px;border-radius:999px;background:#0b172e;border:1px solid #24324a;color:#cbd5e1;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" style="max-width:520px;margin:0 auto">
    <h1>Admin Login</h1>
    <form id="f" autocomplete="off">
      <label>Username</label><input id="u" required>
      <label>Password</label><input id="p" type="password" required>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="primary" type="submit">Sign In</button>
        <a class="ghost" href="/student-track.html" style="text-decoration:none;padding:10px 14px;border-radius:10px">Student Tracking</a>
      </div>
      <!--
      <button class="ghost" type="button" id="exportBtn" style="margin-top:10px">Export All Tickets (Excel)</button>
      -->
      <div id="err" class="muted" style="color:#fecaca;margin-top:10px"></div>
    </form>
  </div>
</div>

<script>
function saveSession(){localStorage.setItem('regAdmin','1');}
document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const body={ username: document.getElementById('u').value.trim(), password: document.getElementById('p').value };
  const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  if(!r.ok){ document.getElementById('err').textContent=(await r.text()); return; }
  saveSession(); location.href='/admin-entry.html';
});
async function exportTicketsCSV(filename='tickets-export.csv'){
  try{const r=await fetch('/api/ticket?limit=1000'); if(!r.ok) return alert(await r.text());
    const rows=await r.json(); if(!rows.length) return alert('No data to export.');
    const headers=['_id','ref','studentId','studentName','requestType','dateReceived','scheduleRelease','dateRelease','processingDays','targetDays','remarks','staff','status','createdAt'];
    const csv=[headers.join(',')];
    for(const t of rows){csv.push(headers.map(h=>`"${(t[h]??'').toString().replace(/"/g,'""')}"`).join(','));}
    const blob=new Blob([csv.join('\n')],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1500);
  }catch(e){alert(String(e));}
}
document.getElementById('exportBtn').onclick=()=>exportTicketsCSV('tickets-export.csv');
</script> 

</body></html>
